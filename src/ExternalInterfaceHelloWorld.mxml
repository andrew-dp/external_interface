<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" minWidth="955" minHeight="600"
			   xmlns:components="components.*">
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import components.ExternalDownloadManager;
			import components.HTTPStreamDownloader;
			
			import mx.utils.Base64Decoder;
			
			protected var video:HTTPStreamDownloader;
			protected var audio:HTTPStreamDownloader;
			
			protected const videoURL:String = 'http://dash.edgesuite.net/dash264/TestCases/1a/netflix/ElephantsDream_AAC48K_064.mp4.dash?range=0-1500';
			protected const audioURL:String = 'http://dash.edgesuite.net/dash264/TestCases/1a/netflix/ElephantsDream_H264BPL30_0100.264.dash?range=0-1500';
			
			protected var _bytes:ByteArray;
			
			protected function urlDownloader_clickHandler(event:MouseEvent):void
			{
//				video =  new HTTPStreamDownloader();
//				audio = new HTTPStreamDownloader();
//				
//				video.open('http://dash.edgesuite.net/dash264/TestCases/1a/netflix/ElephantsDream_AAC48K_064.mp4.dash?range=0-1500');
//				audio.open('http://dash.edgesuite.net/dash264/TestCases/1a/netflix/ElephantsDream_H264BPL30_0100.264.dash?range=0-1500');
			
				var downloadManager:ExternalDownloadManager = ExternalDownloadManager.getInstance();
				downloadManager.download(videoURL, saveBytes);
			}
			
			protected function saveBytes(stream:String):void
			{
				var streamDecoder:Base64Decoder = new Base64Decoder();
				streamDecoder.decode(stream);
				_bytes = streamDecoder.toByteArray();
				trace("_bytes when saved: " + _bytes)
			}
			
			protected function getBytes_clickHandler(event: MouseEvent):void
			{
//				video.getBytes();
//				audio.getBytes();
				
				this.getBytes();
			}
			
			public function getBytes():IDataInput
			{
				trace("_bytes when retreived: " + _bytes);
				return _bytes;
			}
			
		]]>
	</fx:Script>
	<mx:VBox>
		<s:Button label="call url downloader" click="urlDownloader_clickHandler(event)" />
		<s:Button label="call get bytes" click="getBytes_clickHandler(event)" />
	</mx:VBox>
	
</s:Application>
